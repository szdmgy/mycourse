{% extends "base.html" %}
{% block title %}数据导入 - 实验报告收集系统{% endblock %}
{% block nav_admin %}active{% endblock %}

{% block content %}
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb" style="font-size:.85rem;">
    <li class="breadcrumb-item"><a href="{% url 'manager' %}">管理员控制台</a></li>
    <li class="breadcrumb-item active">数据导入</li>
  </ol>
</nav>

<h2 class="mb-3"><i class="bi bi-file-earmark-excel"></i> 数据导入</h2>

{% if error %}
<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> {{ error }}</div>
{% endif %}
{% if success %}
<div class="alert alert-success"><i class="bi bi-check-circle"></i> {{ success }}</div>
{% endif %}

<!-- 课程数据导入 -->
<div class="card mb-3">
  <div class="card-header">
    <strong><i class="bi bi-journal-text"></i> 导入课程数据</strong>
    <span class="badge bg-primary ms-2">含学生名单</span>
  </div>
  <div class="card-body">
    <p style="font-size:.85rem; color:#666;">上传深大课程 Excel 文件，系统会解析课程信息和学生名单，预览确认后再写入。</p>
    <form method="post" action="{% url 'preview_import' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="datatype" value="course">
      <div class="row g-2 align-items-end">
        <div class="col-md-6">
          <label class="form-label">选择课程 Excel 文件</label>
          <input type="file" class="form-control" name="upload_file" accept=".xls,.xlsx,.xlsm" required>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-eye"></i> 预览导入
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- 教师数据导入 -->
<div class="card mb-3">
  <div class="card-header">
    <strong><i class="bi bi-person-badge"></i> 导入教师数据</strong>
  </div>
  <div class="card-body">
    <p style="font-size:.85rem; color:#666;">Excel 格式：工号 | 姓名 | 性别（从第 1 行开始，无表头）。已存在的教师将自动跳过。</p>
    <form method="post" action="{% url 'preview_import' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="datatype" value="teacher">
      <div class="row g-2 align-items-end">
        <div class="col-md-6">
          <label class="form-label">选择教师 Excel 文件</label>
          <input type="file" class="form-control" name="upload_file" accept=".xls,.xlsx,.xlsm" required>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-eye"></i> 预览导入
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body" style="font-size:.85rem; color:#888;">
    <i class="bi bi-info-circle"></i>
    作业导入请到对应课程的「作业管理」页面使用「导入实验」功能。
  </div>
</div>
{% endblock %}
