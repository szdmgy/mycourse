{% extends "base.html" %}
{% block title %}我的课程 - 实验报告收集系统{% endblock %}
{% block nav_stu_courses %}active{% endblock %}

{% block extra_css %}
<style>
  .term-header {
    cursor: pointer;
    user-select: none;
    padding: 10px 16px;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background .15s;
  }
  .term-header:hover { background: #e9ecef; }
  .course-mini {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    text-decoration: none;
    color: inherit;
    transition: box-shadow .15s, border-color .15s;
  }
  .course-mini:hover {
    border-color: #0d6efd;
    box-shadow: 0 2px 8px rgba(13,110,253,.12);
    color: inherit;
  }
  .course-mini .name {
    font-weight: 600;
    font-size: .95rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .course-mini .meta {
    font-size: .78rem;
    color: #888;
    white-space: nowrap;
  }
</style>
{% endblock %}

{% block content %}
<h2 class="mb-3"><i class="bi bi-book"></i> 我的课程</h2>

{% if term_groups %}
  <p class="text-muted mb-3" style="font-size:.85rem;">
    共 {{ total_courses }} 门课程，{{ term_groups|length }} 个学期。点击课程卡片进入作业列表
  </p>

  {% for term, courses in term_groups.items %}
  <div class="mb-3">
    <div class="term-header" data-bs-toggle="collapse" data-bs-target="#term-{{ forloop.counter }}">
      <div>
        <i class="bi bi-calendar3 me-1"></i>
        <strong>{{ term }}</strong>
        <span class="badge bg-primary ms-2">{{ courses|length }} 门课</span>
      </div>
      <i class="bi {% if forloop.first %}bi-chevron-up{% else %}bi-chevron-down{% endif %}"></i>
    </div>
    <div class="collapse {% if forloop.first %}show{% endif %}" id="term-{{ forloop.counter }}">
      <div class="row g-2 mb-2">
        {% for c in courses %}
        <div class="col-sm-6 col-md-4 col-lg-3">
          <a href="{% url 'studentCourse' c.courseTerm c.courseName c.classNumber %}"
             class="course-mini">
            <div style="min-width:0;">
              <div class="name">{{ c.courseName }}</div>
              <div class="meta">{{ c.classNumber }}班 · {{ c.teachers }}</div>
            </div>
            <span class="badge bg-primary rounded-pill ms-2">{{ c.task_count }}</span>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endfor %}

{% else %}
  <div class="card p-4 text-center">
    <p style="font-size:1rem; color:#666;">
      <i class="bi bi-info-circle"></i> 目前你没有选择课程，请联系老师导入名单！
    </p>
  </div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.querySelectorAll('.term-header').forEach(function(header) {
  var target = document.querySelector(header.getAttribute('data-bs-target'));
  var chevron = header.querySelector('[class*="bi-chevron"]');
  if (!target || !chevron) return;
  target.addEventListener('hidden.bs.collapse', function() {
    chevron.classList.replace('bi-chevron-up', 'bi-chevron-down');
  });
  target.addEventListener('shown.bs.collapse', function() {
    chevron.classList.replace('bi-chevron-down', 'bi-chevron-up');
  });
});
</script>
{% endblock %}
