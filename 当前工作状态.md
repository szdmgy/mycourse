# mycourse 项目 — 当前工作状态

> 本文件由 AI 维护，用于跨对话窗口保持上下文。每完成一个阶段性节点主动更新。

---

## 项目概况

- **项目**：mycourse — 学生实验报告收集系统（Django 5.2 + SQLite + Bootstrap）
- **目标**：在保留现有功能的基础上优化升级
- **核心文档**：
  - `需求文档.md` — 完整需求规格
  - `开发计划.md` — 分 10 阶段实施计划
- **Django 项目根目录**：`g:\cursor\projects\mycourse\mycourse\mycourse\`（manage.py 所在层）

---

## 当前进度

| 阶段 | 内容 | 状态 |
|------|------|------|
| 阶段 0 | 准备工作（Git、venv、启动脚本、离线资源） | ✅ 已完成 |
| 阶段 1 | 数据模型升级 | ✅ 已完成 |
| 阶段 2 | 核心 Bug 修复 + 代码清理 | ✅ 已完成 |
| 阶段 3 | 后端功能新增（多附件、复用、教师管理实验） | 待开始 |
| 阶段 4 | 导入预览确认流程 | 待开始 |
| 阶段 5 | UI 基础框架（base.html + Bootstrap 5 + 大字体） | 待开始 |
| 阶段 6 | 学生端页面 | 待开始 |
| 阶段 7 | 教师端页面（Tab 布局） | 待开始 |
| 阶段 8 | 管理员页面 + 导入预览前端 | 待开始 |
| 阶段 9 | 收尾清理 + 回归测试 | 待开始 |

---

## 关键决策记录

1. **密码验证器全部禁用** — 用户明确要求，不修改
2. **教师不能访问 Django Admin** — 只有管理员（superuser）可以
3. **管理员权限 ≥ 教师** — 管理员能操作所有课程，复用实验时能看所有人的
4. **多附件**：1~3 个槽位，每个槽位有名称（教师创建实验时必须指定）
5. **历史实验复用**：教师只能复用自己的，管理员可看所有人的
6. **导入流程**：解析 → 预览 → 用户确认 → 才写入数据库
7. **前端资源全部离线**，禁止 CDN（部署环境无外网）
8. **字体偏大**：正文 20px，适合教学投影场景
9. **数据库可重建**：除管理员和教师账号外，其它数据可不保留
10. **两套启动脚本**：`run_local.bat`（测试端口 9900）+ `start_server.bat`（Waitress 生产端口 8001）
11. **Excel 导入格式**：按深圳大学学生成绩登记表格式（样表：`g:\教学\2025\单片机\单片机原理与应用1班.xlsx`）

---

## 待办/待确认事项

- 阶段 3 开始前：需要用户测试确认阶段 2 的成果

---

## 上次更新

- 时间：2026-02-22
- 内容：完成阶段 2 核心 Bug 修复 + 代码清理（commit: `640ac14`）
  - 新建 `app01/utils.py`：提取 file_iterator、is_teacher_or_admin、get_display_name、safe_filename
  - 修复 Bug#1：removeStudentByTeacher-btn 硬编码路由 → 改用 `/removeStudent/{courseID}/{studentNumber}/`
  - 修复 Bug#2：addHomework 课程查找改用 courseID（保留 courseNumber+courseName 兼容）
  - 修复 Bug#3：addHomework 标题查重范围限定为当前课程
  - 修复 Bug#4：filePath.split('\\') 全部改为 os.path.basename()
  - 修复 Bug#5：file_iterator 重复定义3次 → 统一到 utils.py
  - 修复 Bug#6：临时 ZIP 并发冲突 → 改用 tempfile.NamedTemporaryFile
  - 修复 Bug#9：所有 print() 替换为 logging
  - 适配新模型：所有视图中 Homework.filePath 引用改为 HomeworkFile 查询
  - 所有需认证视图添加 @login_required
  - 权限检查统一：管理员可执行教师操作（is_teacher_or_admin）
  - 清理大量注释掉的死代码
